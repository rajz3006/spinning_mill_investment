<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Executive Dashboard - Spinning Mill Project</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 300;
        }
        
        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .live-indicator {
            position: absolute;
            top: 20px;
            right: 30px;
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255,255,255,0.1);
            padding: 8px 15px;
            border-radius: 20px;
        }
        
        .pulse-dot {
            width: 10px;
            height: 10px;
            background: #28a745;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .navigation-bar {
            background: #f8f9fa;
            padding: 15px 30px;
            border-bottom: 1px solid #dee2e6;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .back-btn {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.3s ease;
            text-decoration: none;
        }
        
        .back-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            color: white;
        }
        
        .export-btn {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        }
        
        .refresh-btn {
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
        }
        
        .data-status {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #28a745;
        }
        
        .main-content {
            padding: 30px;
        }
        
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .kpi-card {
            background: linear-gradient(135deg, #fff 0%, #f8f9fa 100%);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            border-left: 5px solid #007bff;
            position: relative;
            overflow: hidden;
        }
        
        .kpi-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.15);
        }
        
        .kpi-card.revenue {
            border-left-color: #28a745;
        }
        
        .kpi-card.profitability {
            border-left-color: #007bff;
        }
        
        .kpi-card.production {
            border-left-color: #ffc107;
        }
        
        .kpi-card.efficiency {
            border-left-color: #17a2b8;
        }
        
        .kpi-card.financial {
            border-left-color: #6f42c1;
        }
        
        .kpi-card.roi {
            border-left-color: #dc3545;
        }
        
        .kpi-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .kpi-title {
            font-size: 1rem;
            color: #495057;
            font-weight: 600;
        }
        
        .kpi-icon {
            font-size: 2rem;
            opacity: 0.3;
        }
        
        .kpi-value {
            font-size: 2.2rem;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 8px;
        }
        
        .kpi-subtitle {
            font-size: 0.9rem;
            color: #6c757d;
            margin-bottom: 10px;
        }
        
        .kpi-trend {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.85rem;
            font-weight: 500;
        }
        
        .trend-up {
            color: #28a745;
        }
        
        .trend-down {
            color: #dc3545;
        }
        
        .trend-neutral {
            color: #6c757d;
        }
        
        .performance-section {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .performance-metrics {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        
        .performance-metrics h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.3rem;
        }
        
        .milestone-tracker {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        
        .milestone-tracker h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.3rem;
        }
        
        .milestone-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 12px;
            margin: 10px 0;
            background: #f8f9fa;
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        
        .milestone-item:hover {
            background: #e9ecef;
        }
        
        .milestone-status {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: 600;
            color: white;
        }
        
        .milestone-completed {
            background: #28a745;
        }
        
        .milestone-current {
            background: #ffc107;
        }
        
        .milestone-pending {
            background: #6c757d;
        }
        
        .milestone-text {
            flex: 1;
            color: #495057;
            font-weight: 500;
        }
        
        .performance-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .performance-item {
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #007bff;
        }
        
        .performance-value {
            font-size: 1.4rem;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 5px;
        }
        
        .performance-label {
            font-size: 0.9rem;
            color: #6c757d;
        }
        
        .insights-section {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        .insights-section h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.3rem;
        }
        
        .insights-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .insight-card {
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #007bff;
        }
        
        .insight-excellent {
            background: #f0fff4;
            border-left-color: #28a745;
        }
        
        .insight-good {
            background: #f8f9fa;
            border-left-color: #007bff;
        }
        
        .insight-warning {
            background: #fffbf0;
            border-left-color: #ffc107;
        }
        
        .insight-critical {
            background: #fff5f5;
            border-left-color: #dc3545;
        }
        
        .insight-title {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
        }
        
        .insight-description {
            font-size: 0.9rem;
            color: #6c757d;
            line-height: 1.4;
        }
        
        .executive-summary {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        
        .executive-summary h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.3rem;
        }
        
        .table-container {
            overflow-x: auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85rem;
        }
        
        th {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 12px 8px;
            text-align: center;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        td {
            padding: 10px 8px;
            text-align: center;
            border-bottom: 1px solid #e9ecef;
        }
        
        tr:hover {
            background: #f8f9fa;
        }
        
        .number {
            font-family: 'Courier New', monospace;
            font-weight: 500;
        }
        
        .positive {
            color: #28a745;
            font-weight: 600;
        }
        
        .negative {
            color: #dc3545;
            font-weight: 600;
        }
        
        .break-even-month {
            background: #fff3cd;
            color: #856404;
            font-weight: 600;
        }
        
        .alert {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .error-alert {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        
        .warning-alert {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
        }
        
        @media (max-width: 768px) {
            .kpi-grid {
                grid-template-columns: 1fr;
            }
            
            .performance-section {
                grid-template-columns: 1fr;
            }
            
            .insights-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 1.8rem;
            }
            
            .live-indicator {
                position: relative;
                top: 0;
                right: 0;
                margin-top: 15px;
            }
            
            table {
                font-size: 0.75rem;
            }
            
            th, td {
                padding: 6px 4px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="live-indicator">
                <div class="pulse-dot"></div>
                <span>Live Data</span>
            </div>
            <h1>Executive Dashboard</h1>
            <p>Real-time Performance Indicators & Strategic Insights</p>
        </div>
        
        <div class="navigation-bar">
            <a href="index.html" class="back-btn">‚Üê Back to Hub</a>
            <div class="data-status">
                <span class="status-indicator" id="dataStatus"></span>
                <span id="dataStatusText">Data Connected</span>
                <span style="font-size: 0.8rem; color: #6c757d; margin-left: 10px;" id="lastUpdated">Last updated: Now</span>
            </div>
            <div>
                <button class="back-btn refresh-btn" onclick="refreshDashboard()">üîÑ Refresh</button>
                <button class="back-btn export-btn" onclick="exportToCSV()">üìä Export Dashboard</button>
            </div>
        </div>
        
        <div class="main-content">
            <div id="alertContainer"></div>
            
            <!-- Key Performance Indicators -->
            <div class="kpi-grid">
                <div class="kpi-card revenue">
                    <div class="kpi-header">
                        <div class="kpi-title">24-Month Revenue</div>
                        <div class="kpi-icon">üí∞</div>
                    </div>
                    <div class="kpi-value" id="totalRevenue">‚Çπ0</div>
                    <div class="kpi-subtitle">Total projected revenue</div>
                    <div class="kpi-trend" id="revenueTrend">
                        <span>üìà</span> Steady growth projected
                    </div>
                </div>
                
                <div class="kpi-card profitability">
                    <div class="kpi-header">
                        <div class="kpi-title">Net Profitability</div>
                        <div class="kpi-icon">üìà</div>
                    </div>
                    <div class="kpi-value" id="netProfitability">‚Çπ0</div>
                    <div class="kpi-subtitle">After all expenses & interest</div>
                    <div class="kpi-trend" id="profitabilityTrend">
                        <span>üìä</span> Margin analysis
                    </div>
                </div>
                
                <div class="kpi-card production">
                    <div class="kpi-header">
                        <div class="kpi-title">Total Production</div>
                        <div class="kpi-icon">üè≠</div>
                    </div>
                    <div class="kpi-value" id="totalProduction">0 MT</div>
                    <div class="kpi-subtitle">24-month yarn output</div>
                    <div class="kpi-trend" id="productionTrend">
                        <span>‚ö°</span> 100% capacity utilization
                    </div>
                </div>
                
                <div class="kpi-card efficiency">
                    <div class="kpi-header">
                        <div class="kpi-title">Break-even Month</div>
                        <div class="kpi-icon">üéØ</div>
                    </div>
                    <div class="kpi-value" id="breakEvenMonth">Month 0</div>
                    <div class="kpi-subtitle">Cash flow positive</div>
                    <div class="kpi-trend" id="breakEvenTrend">
                        <span>‚è±Ô∏è</span> Operational milestone
                    </div>
                </div>
                
                <div class="kpi-card financial">
                    <div class="kpi-header">
                        <div class="kpi-title">Working Capital</div>
                        <div class="kpi-icon">üîÑ</div>
                    </div>
                    <div class="kpi-value" id="workingCapital">‚Çπ0</div>
                    <div class="kpi-subtitle">Final cash position</div>
                    <div class="kpi-trend" id="workingCapitalTrend">
                        <span>üíº</span> Liquidity status
                    </div>
                </div>
                
                <div class="kpi-card roi">
                    <div class="kpi-header">
                        <div class="kpi-title">24-Month ROI</div>
                        <div class="kpi-icon">üöÄ</div>
                    </div>
                    <div class="kpi-value" id="roi24Month">0%</div>
                    <div class="kpi-subtitle">Return on investment</div>
                    <div class="kpi-trend" id="roiTrend">
                        <span>üìä</span> Investment performance
                    </div>
                </div>
            </div>
            
            <!-- Performance Metrics & Milestones -->
            <div class="performance-section">
                <div class="performance-metrics">
                    <h3>üìä Current Month Performance</h3>
                    <div class="performance-grid">
                        <div class="performance-item">
                            <div class="performance-value" id="currentProduction">0 MT</div>
                            <div class="performance-label">Monthly Production</div>
                        </div>
                        <div class="performance-item">
                            <div class="performance-value" id="currentRevenue">‚Çπ0</div>
                            <div class="performance-label">Monthly Revenue</div>
                        </div>
                        <div class="performance-item">
                            <div class="performance-value" id="currentCosts">‚Çπ0</div>
                            <div class="performance-label">Monthly Costs</div>
                        </div>
                        <div class="performance-item">
                            <div class="performance-value" id="currentMargin">0%</div>
                            <div class="performance-label">Profit Margin</div>
                        </div>
                        <div class="performance-item">
                            <div class="performance-value" id="capacityUtilization">100%</div>
                            <div class="performance-label">Capacity Utilization</div>
                        </div>
                        <div class="performance-item">
                            <div class="performance-value" id="cashPosition">‚Çπ0</div>
                            <div class="performance-label">Current Cash Position</div>
                        </div>
                    </div>
                </div>
                
                <div class="milestone-tracker">
                    <h3>üéØ Project Milestones</h3>
                    <div id="milestonesContainer">
                        <!-- Dynamic milestones will be populated here -->
                    </div>
                </div>
            </div>
            
            <!-- Smart Insights -->
            <div class="insights-section">
                <h3>üí° Strategic Insights & Recommendations</h3>
                <div class="insights-grid" id="insightsContainer">
                    <!-- Dynamic insights will be populated here -->
                </div>
            </div>
            
            <!-- Executive Summary Table -->
            <div class="executive-summary">
                <h3>üìã 24-Month Executive Summary</h3>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Month</th>
                                <th>Production (MT)</th>
                                <th>Revenue (‚ÇπL)</th>
                                <th>Costs (‚ÇπL)</th>
                                <th>EBITDA (‚ÇπL)</th>
                                <th>Interest (‚ÇπL)</th>
                                <th>Net PNL (‚ÇπL)</th>
                                <th>Cash Flow (‚ÇπL)</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="summaryTable">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global project data
        let projectData = {};

        // Load project data from localStorage
        function loadProjectData() {
            const savedData = localStorage.getItem('spinningMillProjectData');
            if (savedData) {
                projectData = JSON.parse(savedData);
                document.getElementById('dataStatus').style.background = '#28a745';
                document.getElementById('dataStatusText').textContent = 'Data Connected';
                return true;
            } else {
                document.getElementById('dataStatus').style.background = '#dc3545';
                document.getElementById('dataStatusText').textContent = 'No Data Found';
                showAlert('No project assumptions found. Please set up your project assumptions first.', 'error');
                return false;
            }
        }

        // Show alert messages
        function showAlert(message, type = 'info') {
            const alertContainer = document.getElementById('alertContainer');
            let alertClass = '';
            if (type === 'error') alertClass = 'error-alert';
            else if (type === 'warning') alertClass = 'warning-alert';
            
            alertContainer.innerHTML = `
                <div class="alert ${alertClass}">
                    ${message}
                </div>
            `;
        }

        // Calculate monthly revenue
        function calculateMonthlyRevenue(month) {
            const yearFactor = Math.floor((month - 1) / 12);
            const escalatedYarnPrice = projectData.yarnPrice * Math.pow(1 + projectData.priceEscalation / 100, yearFactor);
            const escalatedWastagePrice = projectData.wastagePrice * Math.pow(1 + projectData.priceEscalation / 100, yearFactor);
            
            const monthlyProductionKg = projectData.dailyProduction * projectData.operatingDays;
            
            // Yarn revenue
            const yarnRevenue = (monthlyProductionKg * escalatedYarnPrice) / 100000;
            
            // Wastage revenue
            const wastageRevenue = (monthlyProductionKg * escalatedWastagePrice) / 100000;
            
            return yarnRevenue + wastageRevenue;
        }

        // Calculate monthly costs
        function calculateMonthlyCosts(month) {
            const yearFactor = Math.floor((month - 1) / 12);
            
            // Cotton costs
            const dailyCottonReq = projectData.dailyProduction / projectData.conversionRatio;
            const monthlyCottonKg = dailyCottonReq * projectData.operatingDays;
            const monthlyCandys = monthlyCottonKg / 356;
            const escalatedCottonPrice = projectData.cottonCostPerCandy * Math.pow(1 + projectData.priceEscalation / 100, yearFactor);
            const cottonCost = (monthlyCandys * escalatedCottonPrice) / 100000;
            
            // Fixed costs
            const escalatedFixedCosts = projectData.totalFixedCosts * Math.pow(1 + projectData.priceEscalation / 100, yearFactor);
            
            return cottonCost + escalatedFixedCosts;
        }

        // Calculate monthly investment interest
        function calculateMonthlyInterest() {
            return (projectData.initialInvestment * 100 * projectData.investmentInterestRate / 100) / 12;
        }

        // Update KPI cards
        function updateKPICards() {
            const monthlyInterest = calculateMonthlyInterest();
            let totalRevenue = 0;
            let totalCosts = 0;
            let totalInterest = 0;
            let totalProduction = 0;
            let breakEvenMonth = null;
            let finalCashPosition = projectData.initialInvestment * 100; // Starting cash position
            
            // Calculate totals and find break-even
            for (let month = 1; month <= 24; month++) {
                const revenue = calculateMonthlyRevenue(month);
                const costs = calculateMonthlyCosts(month);
                const production = (projectData.dailyProduction * projectData.operatingDays) / 1000;
                
                totalRevenue += revenue;
                totalCosts += costs;
                totalInterest += monthlyInterest;
                totalProduction += production;
                
                const netCashFlow = revenue - costs - monthlyInterest;
                finalCashPosition += netCashFlow;
                
                // Check for break-even (when cumulative cash flow becomes positive)
                if (breakEvenMonth === null && finalCashPosition > (projectData.initialInvestment * 100)) {
                    breakEvenMonth = month;
                }
            }
            
            const netProfitability = totalRevenue - totalCosts - totalInterest;
            const roi24Month = ((finalCashPosition - (projectData.initialInvestment * 100)) / (projectData.initialInvestment * 100)) * 100;
            
            // Update KPI values
            document.getElementById('totalRevenue').textContent = `‚Çπ${(totalRevenue / 100).toFixed(2)} Cr`;
            document.getElementById('netProfitability').textContent = `‚Çπ${(netProfitability / 100).toFixed(2)} Cr`;
            document.getElementById('totalProduction').textContent = `${totalProduction.toFixed(0)} MT`;
            document.getElementById('breakEvenMonth').textContent = breakEvenMonth ? `Month ${breakEvenMonth}` : 'Not Achieved';
            document.getElementById('workingCapital').textContent = `‚Çπ${(finalCashPosition / 100).toFixed(2)} Cr`;
            document.getElementById('roi24Month').textContent = `${roi24Month.toFixed(1)}%`;
            
            // Update trend indicators
            updateTrendIndicators(netProfitability, breakEvenMonth, roi24Month);
        }

        // Update trend indicators
        function updateTrendIndicators(netProfitability, breakEvenMonth, roi24Month) {
            const revenueTrend = document.getElementById('revenueTrend');
            const profitabilityTrend = document.getElementById('profitabilityTrend');
            const breakEvenTrend = document.getElementById('breakEvenTrend');
            const roiTrend = document.getElementById('roiTrend');
            
            if (netProfitability > 0) {
                profitabilityTrend.innerHTML = '<span>üìà</span> Profitable operations';
                profitabilityTrend.className = 'kpi-trend trend-up';
            } else {
                profitabilityTrend.innerHTML = '<span>üìâ</span> Loss-making operations';
                profitabilityTrend.className = 'kpi-trend trend-down';
            }
            
            if (breakEvenMonth && breakEvenMonth <= 12) {
                breakEvenTrend.innerHTML = '<span>‚úÖ</span> Early break-even achieved';
                breakEvenTrend.className = 'kpi-trend trend-up';
            } else if (breakEvenMonth && breakEvenMonth <= 24) {
                breakEvenTrend.innerHTML = '<span>‚ö†Ô∏è</span> Late break-even';
                breakEvenTrend.className = 'kpi-trend trend-neutral';
            } else {
                breakEvenTrend.innerHTML = '<span>‚ùå</span> No break-even in 24 months';
                breakEvenTrend.className = 'kpi-trend trend-down';
            }
            
            if (roi24Month > 50) {
                roiTrend.innerHTML = '<span>üöÄ</span> Excellent ROI';
                roiTrend.className = 'kpi-trend trend-up';
            } else if (roi24Month > 20) {
                roiTrend.innerHTML = '<span>üìà</span> Good ROI';
                roiTrend.className = 'kpi-trend trend-up';
            } else if (roi24Month > 0) {
                roiTrend.innerHTML = '<span>üìä</span> Moderate ROI';
                roiTrend.className = 'kpi-trend trend-neutral';
            } else {
                roiTrend.innerHTML = '<span>üìâ</span> Negative ROI';
                roiTrend.className = 'kpi-trend trend-down';
            }
        }

        // Update current month performance
        function updateCurrentPerformance() {
            const currentMonth = 1; // Using Month 1 as current
            const monthlyRevenue = calculateMonthlyRevenue(currentMonth);
            const monthlyCosts = calculateMonthlyCosts(currentMonth);
            const monthlyInterest = calculateMonthlyInterest();
            const monthlyProduction = (projectData.dailyProduction * projectData.operatingDays) / 1000;
            const netPNL = monthlyRevenue - monthlyCosts - monthlyInterest;
            const profitMargin = (netPNL / monthlyRevenue) * 100;
            const currentCashPosition = (projectData.initialInvestment * 100) + netPNL;
            
            document.getElementById('currentProduction').textContent = `${monthlyProduction.toFixed(1)} MT`;
            document.getElementById('currentRevenue').textContent = `‚Çπ${monthlyRevenue.toFixed(2)}L`;
            document.getElementById('currentCosts').textContent = `‚Çπ${monthlyCosts.toFixed(2)}L`;
            document.getElementById('currentMargin').textContent = `${profitMargin.toFixed(1)}%`;
            document.getElementById('capacityUtilization').textContent = '100%';
            document.getElementById('cashPosition').textContent = `‚Çπ${currentCashPosition.toFixed(2)}L`;
        }

        // Generate milestones
        function generateMilestones() {
            const container = document.getElementById('milestonesContainer');
            container.innerHTML = '';
            
            const monthlyRevenue = calculateMonthlyRevenue(1);
            const monthlyCosts = calculateMonthlyCosts(1);
            const monthlyInterest = calculateMonthlyInterest();
            const isOperationallyProfitable = monthlyRevenue > monthlyCosts;
            const isFinallyProfitable = monthlyRevenue > (monthlyCosts + monthlyInterest);
            
            const milestones = [
                {
                    status: 'completed',
                    text: 'Production Setup & Raw Material Procurement',
                    icon: '‚úì'
                },
                {
                    status: 'completed',
                    text: 'Full Capacity Operations (100% from Day 1)',
                    icon: '‚úì'
                },
                {
                    status: isOperationallyProfitable ? 'completed' : 'pending',
                    text: 'Operational Profitability (Revenue > Costs)',
                    icon: isOperationallyProfitable ? '‚úì' : '‚óã'
                },
                {
                    status: isFinallyProfitable ? 'completed' : 'current',
                    text: 'Final Profitability (After Interest Burden)',
                    icon: isFinallyProfitable ? '‚úì' : '‚óê'
                },
                {
                    status: 'pending',
                    text: 'Market Expansion & Product Diversification',
                    icon: '‚óã'
                },
                {
                    status: 'pending',
                    text: 'Technology Upgrade & Automation',
                    icon: '‚óã'
                }
            ];
            
            milestones.forEach(milestone => {
                const item = document.createElement('div');
                item.className = 'milestone-item';
                item.innerHTML = `
                    <div class="milestone-status milestone-${milestone.status}">
                        ${milestone.icon}
                    </div>
                    <div class="milestone-text">${milestone.text}</div>
                `;
                container.appendChild(item);
            });
        }

        // Generate smart insights
        function generateSmartInsights() {
            const container = document.getElementById('insightsContainer');
            container.innerHTML = '';
            
            const monthlyRevenue = calculateMonthlyRevenue(1);
            const monthlyCosts = calculateMonthlyCosts(1);
            const monthlyInterest = calculateMonthlyInterest();
            const netPNL = monthlyRevenue - monthlyCosts - monthlyInterest;
            const profitMargin = (netPNL / monthlyRevenue) * 100;
            
            const insights = [];
            
            // Revenue Analysis
            const yarnRevenue = (projectData.dailyProduction * projectData.operatingDays * projectData.yarnPrice) / 100000;
            const wastageRevenue = (projectData.dailyProduction * projectData.operatingDays * projectData.wastagePrice) / 100000;
            const wastageContribution = (wastageRevenue / monthlyRevenue) * 100;
            
            insights.push({
                type: 'good',
                title: 'Revenue Diversification',
                description: `Wastage revenue contributes ${wastageContribution.toFixed(1)}% (‚Çπ${wastageRevenue.toFixed(2)}L) of total monthly revenue, providing additional income stream beyond primary yarn sales.`
            });
            
            // Profitability Analysis
            if (profitMargin > 5) {
                insights.push({
                    type: 'excellent',
                    title: 'Strong Profitability',
                    description: `Project shows healthy profit margin of ${profitMargin.toFixed(1)}% after all expenses including investment interest. This indicates strong operational efficiency.`
                });
            } else if (profitMargin > 0) {
                insights.push({
                    type: 'good',
                    title: 'Positive Profitability',
                    description: `Project maintains positive profit margin of ${profitMargin.toFixed(1)}%. Consider cost optimization strategies to improve margins further.`
                });
            } else {
                insights.push({
                    type: 'critical',
                    title: 'Negative Profitability',
                    description: `Current operations show negative margin of ${Math.abs(profitMargin).toFixed(1)}%. Immediate focus needed on cost reduction or revenue enhancement.`
                });
            }
            
            // Cost Structure Analysis
            const rawMaterialCost = monthlyCosts - projectData.totalFixedCosts;
            const rawMaterialShare = (rawMaterialCost / monthlyCosts) * 100;
            
            if (rawMaterialShare > 70) {
                insights.push({
                    type: 'warning',
                    title: 'High Raw Material Dependency',
                    description: `Raw materials represent ${rawMaterialShare.toFixed(1)}% of total costs. Consider bulk purchasing agreements or alternative sourcing to reduce cotton cost volatility.`
                });
            }
            
            // Working Capital Analysis
            const workingCapitalRatio = monthlyRevenue / (projectData.initialInvestment * 100);
            if (workingCapitalRatio > 0.15) {
                insights.push({
                    type: 'excellent',
                    title: 'Efficient Working Capital',
                    description: `Monthly revenue of ‚Çπ${monthlyRevenue.toFixed(2)}L against ‚Çπ${projectData.initialInvestment * 100}L investment shows efficient capital utilization with ${(workingCapitalRatio * 100).toFixed(1)}% monthly return.`
                });
            } else {
                insights.push({
                    type: 'warning',
                    title: 'Working Capital Efficiency',
                    description: `Consider optimizing working capital cycle to improve monthly return on invested capital. Current ratio: ${(workingCapitalRatio * 100).toFixed(1)}%`
                });
            }
            
            // Interest Burden Analysis
            const interestCoverage = (monthlyRevenue - monthlyCosts) / monthlyInterest;
            if (interestCoverage > 2) {
                insights.push({
                    type: 'good',
                    title: 'Manageable Interest Burden',
                    description: `Operating profit covers interest burden ${interestCoverage.toFixed(1)}x, indicating comfortable debt servicing capability.`
                });
            } else if (interestCoverage > 1) {
                insights.push({
                    type: 'warning',
                    title: 'Tight Interest Coverage',
                    description: `Interest coverage of ${interestCoverage.toFixed(1)}x is acceptable but leaves limited margin for operational variations. Monitor closely.`
                });
            } else {
                insights.push({
                    type: 'critical',
                    title: 'Insufficient Interest Coverage',
                    description: `Operating profit insufficient to cover interest burden. Consider debt restructuring or operational improvements to improve coverage.`
                });
            }
            
            insights.forEach(insight => {
                const card = document.createElement('div');
                card.className = `insight-card insight-${insight.type}`;
                card.innerHTML = `
                    <div class="insight-title">${insight.title}</div>
                    <div class="insight-description">${insight.description}</div>
                `;
                container.appendChild(card);
            });
        }

        // Generate executive summary table
        function generateSummaryTable() {
            const tableBody = document.getElementById('summaryTable');
            tableBody.innerHTML = '';
            
            let cumulativeCash = projectData.initialInvestment * 100;
            const monthlyInterest = calculateMonthlyInterest();
            
            for (let month = 1; month <= 24; month++) {
                const revenue = calculateMonthlyRevenue(month);
                const costs = calculateMonthlyCosts(month);
                const production = (projectData.dailyProduction * projectData.operatingDays) / 1000;
                const ebitda = revenue - costs;
                const netPNL = ebitda - monthlyInterest;
                
                cumulativeCash += netPNL;
                
                let status = '';
                let statusClass = '';
                if (netPNL > 0) {
                    status = 'Profitable';
                    statusClass = 'positive';
                } else if (netPNL < 0) {
                    status = 'Loss';
                    statusClass = 'negative';
                } else {
                    status = 'Break-even';
                    statusClass = 'break-even-month';
                }
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${month}</td>
                    <td class="number">${production.toFixed(1)}</td>
                    <td class="number">${revenue.toFixed(2)}</td>
                    <td class="number">${costs.toFixed(2)}</td>
                    <td class="number ${ebitda >= 0 ? 'positive' : 'negative'}">${ebitda.toFixed(2)}</td>
                    <td class="number">${monthlyInterest.toFixed(2)}</td>
                    <td class="number ${netPNL >= 0 ? 'positive' : 'negative'}">${netPNL.toFixed(2)}</td>
                    <td class="number ${cumulativeCash >= 0 ? 'positive' : 'negative'}">${cumulativeCash.toFixed(2)}</td>
                    <td class="${statusClass}">${status}</td>
                `;
                tableBody.appendChild(row);
            }
        }

        // Refresh dashboard
        function refreshDashboard() {
            document.getElementById('lastUpdated').textContent = `Last updated: ${new Date().toLocaleTimeString()}`;
            
            if (loadProjectData()) {
                updateKPICards();
                updateCurrentPerformance();
                generateMilestones();
                generateSmartInsights();
                generateSummaryTable();
                showAlert('‚úÖ Dashboard refreshed successfully with latest data.', 'info');
            }
        }

        // Export to CSV
        function exportToCSV() {
            let csv = [];
            
            // Add title and metadata
            csv.push(['Spinning Mill Project - Executive Dashboard']);
            csv.push(['Generated on: ' + new Date().toLocaleString()]);
            csv.push(['']);
            
            // Add KPI summary
            csv.push(['Key Performance Indicators']);
            csv.push(['24-Month Revenue (Crores)', document.getElementById('totalRevenue').textContent]);
            csv.push(['Net Profitability (Crores)', document.getElementById('netProfitability').textContent]);
            csv.push(['Total Production (MT)', document.getElementById('totalProduction').textContent]);
            csv.push(['Break-even Month', document.getElementById('breakEvenMonth').textContent]);
            csv.push(['Working Capital (Crores)', document.getElementById('workingCapital').textContent]);
            csv.push(['24-Month ROI (%)', document.getElementById('roi24Month').textContent]);
            csv.push(['']);
            
            // Add table headers
            csv.push(['Month', 'Production (MT)', 'Revenue (‚ÇπL)', 'Costs (‚ÇπL)', 'EBITDA (‚ÇπL)', 'Interest (‚ÇπL)', 'Net PNL (‚ÇπL)', 'Cash Flow (‚ÇπL)', 'Status']);
            
            // Add table data
            let cumulativeCash = projectData.initialInvestment * 100;
            const monthlyInterest = calculateMonthlyInterest();
            
            for (let month = 1; month <= 24; month++) {
                const revenue = calculateMonthlyRevenue(month);
                const costs = calculateMonthlyCosts(month);
                const production = (projectData.dailyProduction * projectData.operatingDays) / 1000;
                const ebitda = revenue - costs;
                const netPNL = ebitda - monthlyInterest;
                
                cumulativeCash += netPNL;
                
                let status = netPNL > 0 ? 'Profitable' : netPNL < 0 ? 'Loss' : 'Break-even';
                
                csv.push([
                    month,
                    production.toFixed(1),
                    revenue.toFixed(2),
                    costs.toFixed(2),
                    ebitda.toFixed(2),
                    monthlyInterest.toFixed(2),
                    netPNL.toFixed(2),
                    cumulativeCash.toFixed(2),
                    status
                ]);
            }
            
            // Download CSV
            const csvContent = csv.map(row => row.join(',')).join('\n');
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `executive_dashboard_${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            window.URL.revokeObjectURL(url);
        }

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            if (loadProjectData()) {
                updateKPICards();
                updateCurrentPerformance();
                generateMilestones();
                generateSmartInsights();
                generateSummaryTable();
                showAlert('‚úÖ Executive dashboard loaded successfully with comprehensive insights.', 'info');
            } else {
                // Show placeholder data for demonstration
                showAlert('‚ö†Ô∏è Please set up project assumptions first. Using default values for demonstration.', 'error');
                // Load default values for demonstration
                projectData = {
                    dailyProduction: 3300,
                    conversionRatio: 0.69,
                    operatingDays: 30,
                    yarnPrice: 310,
                    wastagePrice: 24,
                    cottonCostPerCandy: 55000,
                    priceEscalation: 3,
                    initialInvestment: 6.00,
                    investmentInterestRate: 9.0,
                    totalFixedCosts: 107.15
                };
                updateKPICards();
                updateCurrentPerformance();
                generateMilestones();
                generateSmartInsights();
                generateSummaryTable();
            }
        });

        // Auto-refresh every 30 seconds
        setInterval(function() {
            document.getElementById('lastUpdated').textContent = `Last updated: ${new Date().toLocaleTimeString()}`;
        }, 30000);
    </script>
</body>
</html>